## CH 2 80X86微处理器

### 学习重点

1. 了解并掌握微处理器基本外部引脚的名称功能
2. 了解X86内部主要功能块的简单作用
3. :star:掌握基本结构寄存器中的通用寄存器、段寄存器、指针寄存器的结构、名称、汇编助记符
4. :star:掌握32位微处理器**三种工作模式**，掌握**实模式的特点**及**寻址存储器各逻辑段时20位物理地址的形成方法**，以及CS、IP，SS、SP，DS、ES各寄存器初值的赋值原则及特点
5. 了解保护模式的工作特点

 ### Intel处理器发展

#### 位和字节

- 位(bit)：计算机所能表示的**最小最基本的数据单位**。作为单位记作b
- 字节(byte)：由**8个二进制位组成**。通常用作计算存储容量的单位。作为单位记作B

#### 字节（数据宽度）

- 微处理器**一次**可直接处理的**二进制数码的位数**
- 通常取决于微处理器内部**通用寄存器的位数**和**数据总线的宽度**
- 微处理器的字长有4位、8位、16位、32位、和64位等

#### 寻址能力

​	CPU能直接存取数据的内存地址的范围，它由CPU的地址总线的数目决定。

#### 主频

主频也叫**时钟频率**，用来表示微处理器的运行速度，主频越高 表明微处理器运行越快，主频的单位是MHz

#### MIPS

MIPS是Millions of Instruction Per Second的缩写，用来表示微处理器的性能----**运算速度**，**每秒钟能执行多少百万条指令**

#### 微处理器的集成度

- 指微处理器芯片上**集成的晶体管的密度**
- 最早Intel 4004的集成度为**2250**个晶体管，Pentium III的集成度已经达到**750万**个晶体管以上，集成度提高了3000多倍。

|  型号   | 发布   年分 | 字长   (位) | 晶体管   (万个) | 数据总线宽度 | 外部总线宽度 |    主频    | 寻址空间 | 高速   缓存 |
| :-----: | :---------: | :---------: | :-------------: | :----------: | :----------: | :--------: | :------: | :---------: |
|  8086   |    1978     |     16      |       2.9       |      16      |      16      |    4.77    |    1M    |     无      |
|  8088   |    1979     |     16      |       2.9       |      16      |      8       |    4.77    |    1M    |     无      |
|   286   |    1982     |     16      |      13.4       |      16      |      16      |    6~20    |   16M    |     无      |
|   386   |    1986     |     32      |      27.5       |      32      |      32      |   12~33    |    4G    |     有      |
|   486   |    1989     |     32      |       120       |      32      |      32      |   25~100   |    4G    |     8K      |
|  奔腾   |    1993     |     32      |       310       |      64      |      64      |   60~166   |    4G    |     8K      |
| 奔腾Pro |    1995     |     32      |       550       |      64      |      64      | 150~   200 |   64G    |  8K   256K  |
|   奔2   |    1997     |     32      |       750       |      64      |      64      |  233~333   |   64G    | 32K   512K  |
| Itanium |    2000     |     64      |      2.2亿      |      64      |      64      |  1 G以上   |   64G    | 6M集成三级  |
|  酷睿2  |    2006     |     64      |     2.91亿      |      64      |      64      |   3.60 G   |   64G    | 6M集成三级  |

### 微处理器内部结构

#### 微处理器的内部结构

![1569680153778](C:\Users\16711\AppData\Roaming\Typora\typora-user-images\1569680153778.png)

##### 微处理器的基本功能模块

- 总线接口单元BIU（寄存器组）
- 执行单元EU（运算器和控制器、寄存器组）

##### Pentium采用了多种先进技术

- CISC和RISC相结合的技术
  - RISC（Reduced Instruction Set Computer），精简指令系统的计算机
  - CISC（Complex Instruction Set Computer），复杂指令系统的计算机
- 超标量流水线技术
  - 标量指单个量，一般的流水计算机因只有一条指令流水线，所以称为标量流水计算机，所谓**超标量**是指其具有两条以上的指令流水线.
- 分支预测技术

#### 基本结构寄储器

##### 486内部寄存器分为4类

1. 基本结构寄存器

2. 浮点寄存器

3. 系统级寄存器

4. 调试测试寄存器

   应用程序只能访问基本结构寄存器和浮点寄存器

   ##### 通用寄存器

![1569681127674](C:\Users\16711\AppData\Roaming\Typora\typora-user-images\1569681127674.png)

- AX (accumulator)-----累加器

- BX (Base)-----基址寄存器

- CX (Count)-------计数器

- DX (Data)-----数据寄存器

  AX、BX、CX、DX 共同特点：

  - 既可作为16位寄存器来用又可作为两个8位寄存器（高、低位）来用；
  - 都是用于**暂存操作数**，或是**运算的中间结果**或**其它一些信息**。

  **指令＝操作码＋操作数**

  

IP、SP、BP、SI、DI：为寻址存贮单元提供偏移地址。其中：

- IP (Instruction Pointer)-------**指令**指针
- SP (Stack Pointer)------**堆栈**指针
- BP (Base Pointer)------**基址**指针
- SI (Source Index)------**源变址寄存器**
- DI (Destination Index)------**目的变址寄存器**



##### 段寄存器

![1569681235724](C:\Users\16711\AppData\Roaming\Typora\typora-user-images\1569681235724.png)

CS、DS、ES、SS------4个段寄存器，和偏移地址寄存器一起形成20位存储器物理地址，对存储器中存放的程序、数据、堆栈区域加以区别、寻址。

- 寻址程序(指令)：CS＋IP；
- 寻址数据：(DS或ES)＋(SI或DI、BX、BP)；
- 寻址堆栈：SS＋(SP或BP)

##### 标志寄存器

![1569681322520](C:\Users\16711\AppData\Roaming\Typora\typora-user-images\1569681322520.png)

标志寄存器FLAGS又称为程序状态字PSW，为16位寄存器，

该寄存器主要有两个作用：

1. 记录CPU运行结果状态标志；
2. 提供控制标志。 
        FLAGS各位含义如下：
   15  14  13  12  11  10   9   8  7  6  5  4  3  2  1  0
                      OF  DF  IF  TF  SF ZF       AF    PF   CF



根据功能，8086的标志可以分为两类：

1. **状态标志**：表示前面的操作执行后，算术逻辑部件处在怎样一种状态，这种状态会像某种先决条件一样影响后面的操作。有**SF、ZF、PF、CF、AF和OF**
2. **控制标志**：每个控制标志都对某一种特定的功能起控制作用。指令系统中有专门的指令用于控制标志的设置和清除。有**DF、 IF、 TF**。 

### 32位微处理器的工作模式

#### 三种工作模式

##### 32位微处理器的地址空间

###### 存储空间

- 物理空间：程序的运行空间，即主存空间

  486有**32条**地址线，内存最大容量**4G**，这4G字节称为物理存储器

  每一单元的地址称为**物理地址**，地址范围：0000,0000 H~FFFF,FFFF H

- 虚拟空间：编程空间

  虚拟存储器是一项软硬件结合的技术

  存储管理部件把主存（物理存储器）和辅存（磁盘）看作是一个整体，即虚拟存储器。允许编程空间为2^64^=64 T

  该空间对应的地址称为虚拟地址或逻辑地址

- 线性空间：当程序从虚拟空间调入物理空间时，要进行地址转换。

  分段部件首先把虚拟地址(编程地址)转换为**线性地址**。

  若不分页，线性地址即物理地址

  分页，分页部件把线性地址转换为物理地址



​		实模式：存储空间仅分段，不分页

​		保护模式：存储空间先分段，再分页

2. I/O空间：486利用低16位地址线访问I/O端口，所以I/O端口最多有2^16^=64 K，I/O地址空间为0000 H～FFFF H。

   注意：

   1. I/O地址空间不分段
   2. I/O地址空间与存储空间不重叠
        CPU有一条控制线M/IO，在硬件设计上用M/IO=1，参与存储器寻址，用M/IO=0参与I/O寻址。
   3.  从PC/XT～Pentium，基于Intel微处理器的系统机，实际上只使用低10位地址线，寻址2^10^=1024个I/O端口。

##### 实地址模式（实模式）

###### 特点

1. 加电、复位之后，486自动工作在实模式，系统在DOS管理下
2. 在实模式下，486只能访问第一个1M内存(00000 H~FFFFF H)
3.  存储管理部件对存储器只进行分段管理，没有分页功能，每一逻辑段的最大容量为64 K
4. 在实模式下，段寄存器中存放段基址

###### 实模式下，物理地址的形成:star:

1. 存储器的分段管理

   把1M(2^20^)字节的存储器分为任意数量的段,每一段长度64K(216)字节

   段的起始地址的高16位地址称为该段的==段基址==

   段内再由16位二进制数寻址，段内寻址的16位二进制数地址是存贮单元到段起始地址的距离，称为==偏移地址==。

   

   <img src="C:\Users\16711\AppData\Roaming\Typora\typora-user-images\image-20191026145851152.png" alt="image-20191026145851152" style="zoom:47%;" />

   <img src="C:\Users\16711\AppData\Roaming\Typora\typora-user-images\image-20191026150024044.png" alt="image-20191026150024044" style="zoom:40%;" />

   存贮器中的每个存贮单元都可以用两个形式的地址来表示：==物理地址和逻辑地址==。物理地址是指1MB存贮区域中的某一单元地址，地址信息是==20位的二进制代码==，以16进制表示是00000H~FFFFFH中的一个单元，CPU访问存贮器时，地址总线上送出的是物理地址。编制程序，则采用==逻辑地址==。逻辑地址由段基址和偏移量组成。

   - 在一个逻辑段中,各单元的==段基址==是相同的
   - ==偏移地址==是该单元相对于段首的地址偏移量

   ​     物理地址是唯一的，不同的逻辑地址可得到相同的物理地址  

   逻辑地址需由程序员在编程时给出
   段  基  址：指明由哪个段寄存器给出即可
   偏移地址：由程序员在程序中给出具体值

2. 各逻辑段物理地址的形成(以16位寻址为例）

   | 逻辑段 | 段基址存放在... | 偏移地址存放在...                | 物理地址         |
   | ------ | --------------- | -------------------------------- | ---------------- |
   | 代码段 | CS              | IP                               | CS*2^4^+IP       |
   | 堆栈段 | SS              | SP                               | SS*2^4^+SP       |
   | 数据段 | DS              | 根据不同的寻址方式选择BX、SI、DI | DS*2^4^+偏移地址 |
   | 附加段 | ES/FS/GS        | 根据不同的寻址方式选择BX、SI、DI |                  |

   代码段:一条指令的一个字节取出后，IP自动加1，指向下一字节

3. 段寄存器和指针寄存器的初值

   CS、IP的初值：由操作系统赋值

   SS、SP的初值：①由程序员赋值    ②由操作系统自动赋值

   DS/ES/FS/GS的初值：由程序员赋值

   BX/SI/DI/BP的初值：由程序员赋值

##### 保护虚拟地址模式（保护模式）

##### 虚拟86模式(了解)

