> å¤ªç¡¬äº†ï¼ï¼ï¼

# ç»™é˜¿é‡Œå·´å·´Fastjsonä¿®bug

[è§†é¢‘é“¾æ¥](https://www.bilibili.com/video/av77302131)

#### æ‰¾bugæ ‡å‡†

1. bugèƒ½å¤ç°
2. bugæ¯”è¾ƒé‡è¦



æ‰¾åˆ°çš„bugï¼šï¼ˆå·²æä¾›å¯å¤ç°çš„æºç ï¼Œæ±‚fixï¼‰fastjsonæ— æ³•ååºåˆ—åŒ–è¶…å‡ºæŸç§é™åˆ¶çš„ç±»[bugé“¾æ¥](https://github.com/alibaba/fastjson/issues/2779)

é¦–å…ˆä»GitHubä¸Šé¢clone fastjsoné¡¹ç›®ï¼Œåœ¨ideaä¸­æ‰“å¼€

ä¹‹é—´ä»GitHubä¸Šé¢ä¸‹è½½é¡¹ç›®å¤ªæ…¢äº†ï¼Œå¯ä»¥æ³¨å†Œä¸ªç äº‘è´¦å·ï¼Œç»‘å®šGitHubè´¦å·ï¼Œç„¶åå¯ä»¥ä»GitHubä¸­å¯¼å…¥ä»“åº“åˆ°ç äº‘ä¸­ï¼Œåœ¨ç äº‘ä¸­ä¸‹è½½é€Ÿåº¦é£å¿«å‘€ï¼

æ‰“å¼€é¡¹ç›®ï¼Œè¿›å…¥teståŒ…

åˆ›å»ºä¸€ä¸ªå’Œä»–ç»™çš„æºç ä¸€æ ·çš„Javaç±»

åœ¨GitHubä¸­ï¼Œç‚¹rawç„¶åå¤åˆ¶

ä»–æºç ä¸­ä½¿ç”¨äº†Lombokï¼ŒLombokæ˜¯ä¸ç”¨æ·»åŠ getterå’Œsetterï¼Œæˆ‘ä»¬å…ˆåˆ æ‰ï¼Œç„¶åè‡ªå·±æ‰‹åŠ¨æ·»åŠ getterå’Œsetter

åˆ›å»ºæµ‹è¯•ç±»ã€‚ã€‚ã€‚æµ‹è¯•æˆåŠŸï¼Œå“ˆå“ˆå“ˆï¼Œæˆ‘ä¸‹è½½äº†ä¸€ä¸ªå·²ç»ä¿®å¤äº†bugçš„ç‰ˆæœ¬

æ²¡äº‹ï¼Œè™½ç„¶ä¿®å¤äº†ï¼Œæˆ‘è¿˜æ˜¯å¯ä»¥è·Ÿç€å­¦ä¹ å…¶ä¸­çš„æŠ€æœ¯

bugå‡ºåœ¨è¿™é‡Œçš„ç¬¬87è¡Œ

![image-20191202230346098](ç¡¬æ ¸ç©ºé—´.assets/image-20191202230346098.png)

æˆ‘ä»¬åœ¨å…¶ä¸‹ä¸€è¡Œæ‰“æ–­ç‚¹ï¼Œè¿›è¡Œè°ƒè¯•ï¼ŒæŸ¥çœ‹codeå˜é‡

![image-20191202230532915](ç¡¬æ ¸ç©ºé—´.assets/image-20191202230532915.png)

> å£°æ˜ï¼šJava å­—èŠ‚ç  magic number å°±æ˜¯CAFE BABE
>
> Javaæœ‰å’–å•¡çš„æ„æ€

#### Evaluate Expressionè¡¨è¾¾å¼æ±‚å€¼

åœ¨codeå‡ºå³é”®æœ‰ä¸ªEvaluate Expressionï¼Œè¡¨è¾¾å¼æ±‚å€¼

![image-20191202230841162](ç¡¬æ ¸ç©ºé—´.assets/image-20191202230841162.png)

å°†å…¶å­—èŠ‚ç è¾“å‡ºåˆ°æ–‡ä»¶bad.class

![image-20191202231109760](ç¡¬æ ¸ç©ºé—´.assets/image-20191202231109760.png)

windowsä¸‹çš„å±•ç¤ºå½“å‰ç›®å½•æ–‡ä»¶æ˜¯dirå‘½ä»¤

å¯ä»¥çœ‹åˆ°å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆäº†bad.class  å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜å·²ç»ä¿®å¤äº†ï¼Œè¿™ä¸ªclassæ–‡ä»¶æ˜¯å¥½çš„ğŸ˜‚  ideaå¯ä»¥åç¼–è¯‘

å¦‚æœæ˜¯åçš„ï¼Œideaæ— æ³•åç¼–è¯‘ï¼Œä¼šå‡ºç°ä¸‹é¢çš„ç»“æœ

![image-20191202234253689](ç¡¬æ ¸ç©ºé—´.assets/image-20191202234253689.png)

æˆ‘ä»¬å…ˆå‡è£…ä»–æ˜¯åçš„ï¼Œç”¨ä¸€äº›å·¥å…·æ¥æŸ¥çœ‹è¿™ä¸ªåçš„å­—èŠ‚ç æ–‡ä»¶

ä¾‹å¦‚ä¸‹é¢çš„å‘½ä»¤

```shell
javap -v bad #Javaè‡ªå¸¦çš„åç¼–è¯‘å·¥å…·
```

ä½†æ˜¯å¤ªé•¿äº†ï¼Œåœ¨å‘½ä»¤è¡Œçœ‹ä¹Ÿä¸å¤ªæ–¹ä¾¿

æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å·¥å…·classpy

#### åç¼–è¯‘å·¥å…·classpy

åœ¨GitHubæœç´¢classpyï¼Œcloneä¸‹æ¥ï¼ŒæŒ‰ç…§readmeå®‰è£…è¿è¡Œ

æˆ‘æ˜¯Windowsç³»ç»Ÿï¼Œé¦–å…ˆè¿›å…¥classpyç›®å½•ä¸‹ï¼Œç‚¹å‡»è¿è¡Œäº†gradlew.batæ–‡ä»¶ï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨è¿™ä¸ªå·¥å…·

```shell
./gradlew run 
```



è§†é¢‘ä¸­ä»–çš„Javaç‰ˆæœ¬ä¸º11ï¼Œå¯åŠ¨å¤±è´¥äº†

ä½¿ç”¨äº†jenvå‘½ä»¤åˆ‡æ¢jdk

```shell
jenv shell 1.8  #éœ€è¦å®‰è£…jenv
```



ä¸‹é¢æ˜¯æ‰“å¼€çš„å­—èŠ‚ç æ–‡ä»¶

![image-20191203001137874](ç¡¬æ ¸ç©ºé—´.assets/image-20191203001137874.png)



ç”±äºæˆ‘ä»¬åªæœ‰Illegal target of jump or branchè¿™ä¸ªæŠ¥é”™ä¿¡æ¯ï¼Œè¿™ä¸€ä¸ªçº¿ç´¢

åˆ°jdkä¸­å¯»æ‰¾æ­¤æŠ¥é”™ä¿¡æ¯ã€‚ã€‚ã€‚ç¡¬æ ¸å•Š  ç„¶åä»–ä¿®æ”¹äº†jdkï¼Œé‡æ–°buildäº†ä¸€ä¸ªjdkï¼Œç”¨è‡ªå·±buildçš„jdkè¿è¡Œä¹‹å‰çš„å­—èŠ‚ç 



å…ˆç®—äº†ï¼Œæ˜å¤©å†ç»§ç»­å†™å§ è§†é¢‘è¿›åº¦æ¡19:12



12/8æ›´æ–°

éšåæ‰¾åˆ°deserializeæ–¹æ³•  å­—èŠ‚ç   ç¬¬50ä¸ªä½ç½®æ˜¯è¿™æ ·çš„

![image-20191208143839540](ç¡¬æ ¸ç©ºé—´.assets/image-20191208143839540.png)

```
ifeq -32405 
```

æº¢å‡º



æˆ‘è¿™é‡Œæ˜¯ä¿®å¤å¥½çš„å•¦ï¼Œé•¿è¿™æ ·

![image-20191208143858700](ç¡¬æ ¸ç©ºé—´.assets/image-20191208143858700.png)

ç„¶åæ ¹æ®ä¸Šä¸‹æ–‡ï¼Œåœ¨æºç ä¸­æ‰¾åˆ°ç›¸åº”ä½ç½®

è§†é¢‘ä¸­çš„

![image-20191208145751790](ç¡¬æ ¸ç©ºé—´.assets/image-20191208145751790.png)

æˆ‘çš„

![image-20191208145718373](ç¡¬æ ¸ç©ºé—´.assets/image-20191208145718373.png)



æœ€åè§£å†³çš„é—®é¢˜ï¼šæŒ‰ç…§asmçš„è¦æ±‚ï¼ŒæŠŠä¸€ä¸ªä¸æ”¯æŒé•¿è·³è½¬çš„ifeqè½¬å˜æˆifnqåŠ goto_wé•¿è·³è½¬è¯­å¥



ä¿®å®Œbugä¸€å®šè¦è¡¥ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼





#### å­—èŠ‚ç çš„è§£é‡Šï¼š

ç®€å•å†™ä¸€ä¸ªæµ‹è¯•ä¸€ä¸‹

```Java
public class AbcDTO {
    public static void main(String [] args) {
        int i =1,j=2;
        if (i+j==3){
            System.out.println("3");
        }else {
            System.out.println("0");
        }
    }
```

ç¼–è¯‘è¿è¡Œï¼Œä½¿ç”¨ASM Bytecode Vieweræ’ä»¶æŸ¥çœ‹å­—èŠ‚ç 

#### ASM Bytecode Vieweræ’ä»¶

å¯åœ¨idea Pluginsä¸­å®‰è£…

![image-20191208144452139](ç¡¬æ ¸ç©ºé—´.assets/image-20191208144452139.png)

æ‰¾åˆ°mainæ–¹æ³•

![image-20191208144825554](ç¡¬æ ¸ç©ºé—´.assets/image-20191208144825554.png)

æ¯ä¸ªæ–¹æ³•é‡Œé¢æœ‰ä¸ªæ“ä½œæ•°æ ˆï¼Œjvmæ‰§è¡Œæ–¹æ³•æ—¶ä¼šä¸åœçš„æ‰§è¡Œè¿™äº›æŒ‡ä»¤





#### ä¿®bugè¦æŒæ¡çš„ä¸œè¥¿

1. é‡ç°bug
2. å­—èŠ‚ç 



Rå¤§çš„ä¹¦å•RednaxelaFX



#### mybatis

1. #{} ${}
2. ç¼“å­˜æ˜¯å’‹å®ç°çš„ï¼Ÿ
3. Executoræ˜¯å•¥ï¼Ÿ
4. åˆ†é¡µæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ